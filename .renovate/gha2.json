{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "description": "This preset consists of a common configuration for updating GitHub Actions. It adds a custom manager to update github-action dependencies for specific repositories. It also includes rules for dependencies like 'slsa-framework/slsa-github-generator' and extends presets for pinning GitHub Action digests to semver versions",
  "extends": [
    "helpers:pinGitHubActionDigests",
    "helpers:pinGitHubActionDigestsToSemver"
  ],
  "customManagers": [
    {
      "description": "This custom manager updates 'bartsmykla/public-shared-actions' in YAML files located in '.github/', 'workflow-templates', or similar directories. The 'fileMatch' patterns match workflows and actions, aligning with the expressions used by the 'github-actions' manager (https://docs.renovatebot.com/modules/manager/github-actions/). It identifies dependencies with or without digests (e.g., '@v2.8.0' or '@digest # v2.8.0')",
      "customType": "regex",
      "managerFilePatterns": [
        "/(^|/)(workflow-templates|\\.(?:github|gitea|forgejo)/(?:workflows|actions))/.+\\.ya?ml$/",
        "/(^|/)action\\.ya?ml$/"
      ],
      "matchStrings": [
        "(?<packageName>bartsmykla\\/public-shared-actions\\/(?<depName>[^\\s@]+))@(?:(?<currentDigest>\\w+)\\s*#\\s*)?v?(?<currentValue>(?:\\d+(?:\\.\\d)+|\\w+))"
      ],
      "datasourceTemplate": "github-tags",
      "extractVersionTemplate": "^@?{{{depName}}}@v?(?<version>[0-9\\.]+)$",
      "autoReplaceStringTemplate": "{{{packageName}}}@{{#if newDigest}}{{{newDigest}}} # {{/if}}v{{{newVersion}}}",
      "versioningTemplate": "semver"
    }
  ],
  "packageRules": [
    {
      "description": "Require manual approval and a 14-day release age before updating tj-actions/changed-files due to a prior supply-chain incident (GHSA-mrrh-fwg8-r2c3). Renovate will not open a PR until approved in the Dependency Dashboard. Once approved, the PR will include a prominent caution to carefully review changes",
      "matchPackageNames": ["tj-actions/changed-files"],
      "matchDatasources": ["github-actions"],
      "minimumReleaseAge": "14 days",
      "prCreation": "approval",
      "prBodyNotes": "> [!CAUTION]\n> This PR updates tj-actions/changed-files. Due to a past supply‑chain incident (GHSA-mrrh-fwg8-r2c3), reviewers must carefully verify all changes, review upstream release notes, and confirm workflow safety before merging"
    },
    {
      "description": "Manage bartsmykla/public-shared-actions updates using the custom manager. Disable the default GitHub Actions manager for these to avoid duplicate processing",
      "matchPackageNames": ["/^bartsmykla\\/public-shared-actions/"],
      "matchManagers": ["github-actions"],
      "enabled": false
    },
    {
      "description": "Do not pin digests for slsa-framework/slsa-github-generator; per upstream guidance digest pinning is not supported. More info: https://github.com/slsa-framework/slsa-github-generator/blob/main/RENOVATE.md",
      "matchManagers": ["github-actions"],
      "matchPackageNames": ["slsa-framework/slsa-github-generator"],
      "pinDigests": false
    },
    {
      "description": "Disable digest updates only for actions that are versioned (i.e., have a tag), to avoid duplicate PRs—one for the digest and one for the version. Digest updates remain enabled for actions pinned solely by digest (e.g., to track master/main), which are not covered by our versioning rules",
      "matchCurrentValue": "/^[^\\.]+\\./",
      "matchUpdateTypes": "digest",
      "enabled": false
    },
    {
      "description": "Ensure commit and PR titles use the full package name for clarity. Prevent automatic lowercasing of the package name to preserve intended casing. Set commit actions to lowercase (e.g., `update`, `pin`, `replace`, `roll back`). Also update the PR body table to show the full name and include a link to the source code",
      "matchManagers": ["regex"],
      "matchPackageNames": ["/^bartsmykla\\/public-shared-actions/"],
      "commitMessageTopic": "{{{packageName}}}",
      "commitMessageLowerCase": "never",
      "commitMessageAction": "bump",
      "pin": {
        "commitMessageAction": "pin"
      },
      "pinDigest": {
        "commitMessageAction": "pin"
      },
      "replacement": {
        "commitMessageAction": "replace"
      },
      "rollback": {
        "commitMessageAction": "roll back"
      },
      "prBodyDefinitions": {
        "Package": "[{{{packageName}}}]({{{sourceUrl}}}) ([source]({{{sourceUrl}}}/tree/{{#if newVersion}}%40{{{depName}}}%40{{{newVersion}}}{{else}}{{#if newDigest}}{{{newDigest}}}{{else}}main{{/if}}{{/if}}/{{{depName}}}))"
      }
    }
  ]
}
