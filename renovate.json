{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "enabledManagers": [
    "custom.regex"
  ],
  "ignorePaths": [],
  "kubernetes": {
    "description": [
      " Update container image tags in Kubernetes manifests installed via",
      " 'kumactl install demo|observability'. Limits matching to the generated YAML under",
      " app/kumactl/data/install/k8s/"
    ],
    "managerFilePatterns": ["/app/kumactl/data/install/k8s/.+\\.ya?ml$/"]
  },
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/(^|/)(workflow-templates|\\.(?:github|gitea|forgejo)/(?:workflows|actions))/.+\\.ya?ml$/",
        "/(^|/)action\\.ya?ml$/"
      ],
      "matchStrings": [
        "(?<packageName>Kong/public-shared-actions/(?:[0-9A-Za-z._-]*/)*(?<depName>[^\\s@]+))@(?:(?<currentDigest>[0-9A-Fa-f]{7,40})[\\t ]*#[\\t ]*)?(?<currentValue>v[0-4]+(?:\\.[0-9]+){0,2}|[0-9]+(?:\\.[0-9]+){0,3}(?:-[0-9A-Za-z.-]+)?)(?<indentation>\\s|$)"
      ],
      "extractVersionTemplate": "^@?(?:[0-9A-Za-z._-]*/)*{{{depName}}}[@_]v?(?<version>[0-9]+(?:\\.[0-9]+){0,3}(?:-[0-9A-Za-z.-]+)?)$",
      "autoReplaceStringTemplate": "{{{packageName}}}@{{#if newDigest}}{{{newDigest}}} # {{/if}}{{{newValue}}}{{{indentation}}}",
      "datasourceTemplate": "github-tags",
      "versioningTemplate": "semver-coerced"
    }
  ],
  "packageRules": [
    {
      "matchManagers": ["custom.regex"],
      "matchPackageNames": ["Kong/public-shared-actions/**"],
      "pinDigests": true
    },
    {
      "description": [
        " Enforce digest pinning for Kong/public-shared-actions sub-actions. This rule prioritizes",
        " and always recreates PRs that pin or refresh commit digests for these actions, bypassing",
        " normal schedules and Renovate rate limits so repositories get secure, updatable references",
        " immediately",
        "",
        " Why: This monorepo now publishes per-sub-action tags like '<name>@<version>'",
        " (e.g., 'workflow-notification@4.0.1') rather than simple 'vX.Y.Z' tags. Repositories",
        " using '...@v2' cannot be auto-migrated to the new tag names without changing",
        " the reference format (which would look like '...@workflow-notification@4.0.1'). Digest",
        " pinning avoids the tag-name mismatch entirely because Renovate tracks and updates",
        " by commit SHA and adds a friendly '# vX.Y.Z' comment for humans"
      ],
      "matchManagers": ["custom.regex"],
      "matchUpdateTypes": ["pinDigest"],
      "matchPackageNames": ["Kong/public-shared-actions/**"],
      "extends": [":disableRateLimiting", ":prImmediately"],
      "recreateWhen": "always",
      "schedule": ["at any time"],
      "dependencyDashboardApproval": false,
      "minimumReleaseAge": null,
      "prHeader": "> [!CAUTION]\n> This PR pins Kong/public-shared-actions to commit digests and is prioritized (bypasses schedules/rate limits). It will be re-created until merged.",
      "prBodyNotes": [
        "> [!NOTE]\n> Why digest pinning is required for Kong/public-shared-actions\n> Kong/public-shared-actions changed release tagging: sub-actions are released with tags in the form '<sub-action-name>@<version>' (not plain 'vX.Y.Z').\n> For example, projects that used '.../slack-actions/workflow-notification@v2' and any other sub-actions previously referenced with plain version tags like 'vX...' or 'X...' cannot be auto-updated by tag alone, because the correct tag  'workflow-notification@4.0.1', which would require '.../workflow-notification@workflow-notification@4.0.1'.\n> With digest pinning, Renovate looks up the tag and records its commit SHA, so the tag name shape no longer matters.\n> Example (safe form):\n> ```yaml\n> uses: Kong/public-shared-actions/slack-actions/workflow-notification@a18abf762d6e2444bcbfd20de70451ea1e3bc1b1 # v4.0.1\n> ```\n> This is safe and recommended: GitHub Actions security guidance advises pinning third-party actions to a full commit SHA to protect against tag moving and supply-chain attacks.\n> References: GitHub Docs (Security hardening, pin to commit SHA): https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions#using-third-party-actions"
      ]
    }
  ]
}
