{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "Kong/public-shared-renovate",
    "Kong/public-shared-renovate//scoped/kuma/go-control-plane",
    "Kong/public-shared-renovate//overrides/security-labels(area/security)",
    "Kong/public-shared-renovate//overrides/security-reviewers(team:kuma-security-managers)",
    ":automergeRequireAllStatusChecks",
    ":automergeMinor",
    ":automergePatch",
    ":combinePatchMinorReleases",
    ":disableRateLimiting",
    ":semanticCommitTypeAll(chore)",
    "docker:pinDigests",
    "schedule:earlyMondays"
  ],
  "ignorePresets": [
    "customManagers:dockerfileVersions",
    "customManagers:helmChartYamlAppVersions",
    "customManagers:tfvarsVersions"
  ],
  "enabledManagers": [
    "custom.regex",
    "dockerfile",
    "github-actions",
    "gomod",
    "helm-values",
    "kubernetes",
    "mise"
  ],
  "ignorePaths": [],
  "internalChecksFilter": "strict",
  "automergeStrategy": "squash",
  "keepUpdatedLabel": "renovate/keep-updated",
  "pin": {"commitMessageAction": "pin"},
  "pinDigest": {"commitMessageAction": "pin"},
  "replacement": {"commitMessageAction": "replace"},
  "rollback": {"commitMessageAction": "roll back"},
  "kubernetes": {
    "description": [
      " Update container image tags in Kubernetes manifests installed via",
      " 'kumactl install demo|observability'. Limits matching to the generated YAML under",
      " app/kumactl/data/install/k8s/"
    ],
    "managerFilePatterns": ["/app/kumactl/(?:cmd|data)/install/(?:k8s|testdata)/.+\\.ya?ml$/"]
  },
  "packageRules": [
    {
      "description": [
        " Show 'Adoption' instead of 'Confidence' in PR body tables for Go updates"
      ],
      "matchDatasources": ["go"],
      "matchUpdateTypes": ["patch", "minor", "major"],
      "prBodyColumns": ["Package", "Type", "Change", "Age", "Adoption"]
    },
    {
      "description": [
        " Update golden test YAML under app/kumactl/cmd/install/testdata to the correct",
        " image versions in the same Renovate run/PR. Combined with the kubernetes",
        " managerFilePatterns, this keeps golden files in sync so we don't have to update them",
        " manually"
      ],
      "matchManagers": ["kubernetes"],
      "matchPackageNames": ["/^gcr.io/octo/", "/^docker.io/kumahq/", "/^kuma-ci/"],
      "matchFileNames": ["/app/kumactl/cmd/install/testdata/.+\\.ya?ml$/"],
      "enabled": false
    },
    {
      "matchDatasources": ["kubernetes-api"],
      "matchFileNames": ["/app/kumactl/cmd/install/testdata/.+\\.ya?ml$/"],
      "enabled": false
    },
    {
      "description": [
        " Group related container image updates in the 'kumactl install demo|observability'",
        " Kubernetes manifests so they land in a single PR"
      ],
      "matchFileNames": ["app/kumactl/{cmd,data}/install/{k8s,testdata}/**"],
      "groupName": "kumactl install demo|observability images{{#each (distinct (lookupArray upgrades \"prettyNewVersion\"))}}{{#if (and @last (equals @index 0))}}to {{.}}{{/if}}{{/each}}",
      "groupSlug": "kumactl-install-k8s-{{#each (distinct (lookupArray upgrades \"prettyNewVersion\"))}}{{#if (and @last (equals @index 0))}}-{{.}}{{/if}}{{/each}}",
      "prFooter": "> Changelog: skip"
    },
    {
      "description": [
        " For GitHub Actions dependency updates, add a 'ci/skip-test' label and use a terse PR",
        " body/footer so these routine workflow bumps don't trigger full CI or clutter the",
        " changelog"
      ],
      "matchManagers": ["github-actions"],
      "addLabels": ["ci/skip-test"],
      "prFooter": "> Changelog: skip"
    },
    {
      "description": [
        " Treat updates to shared Kong GitHub Actions (managed via the regex manager) the same",
        " as other workflow bumps: apply 'ci/skip-test' and keep the PR body minimal to avoid",
        " unnecessary CI load and changelog noise"
      ],
      "matchManagers": ["custom.regex"],
      "matchPackageNames": ["*/public-shared-actions/**"],
      "addLabels": ["ci/skip-test"],
      "prFooter": "> Changelog: skip"
    },
    {
      "description": [
        " Change the commit message topic to 'envoy' for 'kumahq/envoy-builds'. These are",
        " Kuma-maintained builds of released Envoy versions and are handled by the Makefile",
        " regex manager. Using 'envoy' as the topic makes PR titles clearer"
      ],
      "matchDepNames": ["kumahq/envoy-builds"],
      "commitMessageTopic": "envoy"
    },
    {
      "description": [
        " Disable pinning for 'kumahq/openapi-tool'. Pinning this tool to a specific commit or",
        " version is not supported in our current setup and consistently fails, so we skip 'pin'",
        " and 'pinDigest' updates for it. Managed by the Makefile regex manager"
      ],
      "matchManagers": ["custom.regex"],
      "matchDepNames": ["kumahq/openapi-tool"],
      "matchUpdateTypes": ["pin", "pinDigest"],
      "enabled": false
    },
    {
      "description": [
        " For mise-managed dev tools: use semantic commit scope 'deps/dev' for individual (non-grouped) PRs, and 'deps'",
        " when updates are grouped. Add a '> Changelog: skip' footer to individual PRs only, keeping routine tool bumps",
        " out of the main changelog without affecting grouped PRs"
      ],
      "matchManagers": ["mise"],
      "semanticCommitScope": "deps{{#unless isGroup}}/dev{{/unless}}",
      "prFooter": "{{#unless isGroup}}> Changelog: skip{{/unless}}"
    },
    {
      "description": [
        " Simplify commit message topics for 'aqua:*' and 'go:*' tools by stripping any leading",
        " namespace prefix from the dependency name. This makes commit titles shorter and easier",
        " to scan"
      ],
      "matchDepNames": ["/^(?:aqua|go):/"],
      "commitMessageTopic": "{{{replace '([^\\/]*?\\/)*' '' depName}}}"
    },
    {
      "description": [
        " Extract the version for 'aqua:grpc/grpc-go/protoc-gen-go-grpc' from its command path",
        " so Renovate can correctly detect and propose updates for this tool"
      ],
      "matchDepNames": ["aqua:grpc/grpc-go/protoc-gen-go-grpc"],
      "extractVersion": "^cmd/protoc-gen-go-grpc/(?<version>.*)$"
    },
    {
      "description": [
        " Group dependency bumps from selected GitHub sources into a single PR across managers (e.g., mise and gomod)",
        " to avoid separate PRs per manager"
      ],
      "matchSourceUrls": ["https://github.com/{onsi/ginkgo,golangci/golangci-lint,helm/helm}"],
      "groupName": "{{{replace 'https://github\\.com/[a-z-]+/' '' sourceUrl}}}"
    },
    {
      "description": [
        " Group kubectl updates (registry.k8s.io/kubectl or standalone 'kubectl') into a single PR across managers"
      ],
      "matchDepNames": ["{registry.k8s.io/,}kubectl"],
      "groupName": "kubectl"
    },
    {
      "description": [
        " Set commit message fields at the package-rule level with a catch-all match ('*') rather",
        " than at the root. Root-level fields can be overridden by more specific sub-configs and",
        " packageRules from composed presets. By defining commitMessageAction/topic/extra in",
        " a packageRule that matches every dependency, this baseline is applied uniformly after",
        " composition, while still allowing even more specific packageRules to override it when needed.",
        " See: https://docs.renovatebot.com/configuration-options/#packagerules"
      ],
      "matchDepNames": "*",
      "commitMessageAction": "bump",
      "commitMessageLowerCase": "never",
      "commitMessageTopic": "{{#if (containsString packageName '/public-shared-actions/')}}{{{packageName}}}{{else}}{{{depName}}}{{/if}}{{#if (and (equals updateType 'digest') (equals currentValue newValue) newValue)}}:{{{newValue}}}{{/if}}",
      "commitMessageExtra": "{{#unless (and isGroup (or (containsString depName 'helm') (containsString depName 'ginkgo')))}}{{#if (or (and (or isMajor isMinor isPatch) (or isSingleVersion currentDigestShort)) (and (equals updateType 'digest') currentDigestShort))}}from {{#if (equals updateType 'digest')}}{{{currentDigestShort}}}{{else if isSingleVersion}}{{{replace '^v?' 'v' currentValue}}}{{/if}} {{/if}}to {{#if isPinDigest}}{{{newDigestShort}}}{{else if isSingleVersion}}{{prettyNewVersion}}{{else if newValue}}{{{newValue}}}{{else}}{{{newDigestShort}}}{{/if}}{{/unless}}",
      "commitMessageSuffix": "{{#if (and isGroup (or (containsString depName 'helm') (containsString depName 'ginkgo')))}}{{#each (distinct (lookupArray upgrades \"currentValue\"))}}{{#if (and @last (equals @index 0))}}from {{{replace '^v?' 'v' .}}}{{/if}}{{/each}}{{#each (distinct (lookupArray upgrades \"prettyNewVersion\"))}}{{#if (and @last (equals @index 0))}}to {{.}}{{/if}}{{/each}}{{/if}}",
      "prBodyNotes": [
        "---",
        "| Type | Value |\n|------|-------|\n| depName | {{#if depName}}{{{depName}}}{{/if}} |\n| packageName | {{#if packageName}}{{{packageName}}}{{/if}} |\n| sourceUrl | {{#if sourceUrl}}{{{sourceUrl}}}{{/if}} |\n| currentVersion | {{#if currentVersion}}{{{currentVersion}}}{{/if}} |\n| currentValue | {{#if currentValue}}{{{currentValue}}}{{/if}} |\n| newVersion | {{#if newVersion}}{{{newVersion}}}{{/if}} |\n| newValue | {{#if newValue}}{{{newValue}}}{{/if}} |\n| datasource | {{#if datasource}}{{{datasource}}}{{/if}} |\n| manager | {{#if manager}}{{{manager}}}{{/if}} |\n| depType | {{#if depType}}{{{depType}}}{{/if}} |\n| categories | {{#if categories}}{{{categories}}}{{/if}} |\n| commitMessagePrefix | {{#if commitMessagePrefix}}{{{commitMessagePrefix}}}{{/if}} |\n| commitMessageAction | {{#if commitMessageAction}}{{{commitMessageAction}}}{{/if}} |\n| commitMessageTopic | {{#if commitMessageTopic}}{{{commitMessageTopic}}}{{/if}} |\n| commitMessageExtra | {{#if commitMessageExtra}}{{{commitMessageExtra}}}{{/if}} |\n| commitMessageSuffix | {{#if commitMessageSuffix}}{{{commitMessageSuffix}}}{{/if}} |\n| isGroup | {{#if isGroup}}{{{isGroup}}}{{else}}false{{/if}} |\n| isMajor | {{#if isMajor}}{{{isMajor}}}{{else}}false{{/if}} |\n| isMinor | {{#if isMinor}}{{{isMinor}}}{{else}}false{{/if}} |\n| isPatch | {{#if isPatch}}{{{isPatch}}}{{else}}false{{/if}} |\n| isSingleVersion | {{#if isSingleVersion}}{{{isSingleVersion}}}{{else}}false{{/if}} |\n| _isDigest | {{#if (and (equals updateType 'digest') currentDigestShort)}}true{{else}}false{{/if}} |\n| _full | {{#if (or (and (or isMajor isMinor isPatch) (or isSingleVersion currentDigestShort)) (and (equals updateType 'digest') currentDigestShort))}}true{{else}}false{{/if}} |\n| newVersionAgeInDays | {{#if newVersionAgeInDays includeZero=true}}{{{newVersionAgeInDays}}}{{/if}} |\n"
      ],
      "prFooter": "| Type | Value |\n|------|-------|\n| isSingleVersion | {{#if isSingleVersion}}{{{isSingleVersion}}}{{else}}false{{/if}} |\n| newVersion | {{#if newVersion}}{{{newVersion}}}{{/if}} |\n| suffix | {{#each (distinct (lookupArray upgrades \"prettyNewVersion\"))}}{{#if (and @last (equals @index 0))}}to {{.}}{{/if}}{{/each}} |\n````json\n{{{ toJSON (distinct (lookupArray upgrades \"prettyNewVersion\")) }}}\n````\n"
    }
  ]
}
